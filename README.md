# Condensate-Panel-and-Classifier
Uses ML to classify different topologies of multi-component condensates obtained from fluorescence microscopy.

## Steps:

1. Create environment with conda (environment.yml file)
2. Activate this conda environment
3. Using pip, install the puncta_tracking package: pip install ./puncta_tracking-master.zip
4. Run track explorer by: panel serve app.py --show --dev

## How to use the app.py file:

You need 3 files from the same movie for the track explorer:
1. pkl_file -> Path to the trackmate_tracks_dag.pkl file in the results folder
2. movie_path -> Path to the original movie (where intensities are taken from)
3. mask_path -> Path to the mask generated by ilastik (ilastik_mask.tiff)

**See get_track_movie if you are unsure about how to extract bounding box based images from the tracks (this is a hint for the classifier).**

app.py generates a GUI on which you can click on images for classifying them as rings. Currently the GUI part of the application is working as intended. However I just use some test images, not the actual segmented images. To convert to images from segmentation, following steps could be taken in the if __name__ == "__main__": section of the app.py file:

1. Choose any movie in which both rings and punctas are visible (say, any movie in which you see an inverted loop in the phase portrait)
2. Get the movie and the trackmate_spots.csv file
3. In the trackmate_spots.csv file, for each spot, a bounding box is also defined (bbox-0,bbox-1,bbox-2,bbox-3) -> (min_row,min_col,max_row,max_col). Using this, extract the intensity image for each spot in the movie (multi-channel images are accepted in the app.py file, just ensure the channel axis is the last one, so YXC ordering).
4. Replace test_images with your new list of images from the trackmate_spots.csv and movie file. Choose the size of grid (so how many images at once you want to display) by changing the numbers in the line "w = MainWindow(iter(test_images), (3, 3))" (see the comment next to it).

The way the classifier works is that if you click on a ring it will "accept" it in w.accepted_images. At any point, if you click "No rings here", all images open will be "rejected" into w.rejected_images. Once a particular cell in the grid has exhausted all images it can show, it will show just the background and will not be clickable. Once all cells in the grid are not clickable, the GUI will close.

**NOTE:** In the current version of app.py -> it just prints the indices of the accepted images. To save the images selected -> look to saving w.accepted_images and w.rejected_images into a pickle file or something like that.
